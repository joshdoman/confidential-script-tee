# Architecture

TODO

## Key Generation

The enclave securely and deterministically generates the master private key by deriving a shared secret between the KMS key and a timestamped "Nothing-Up-My-Sleeve" (NUMS) public key.

The timestamped NUMS key is generated by hashing a fixed salt with a Bitcoin blockhash that the user provides, incrementing the nonce until a valid public key is found. This process ensures that we derive a shared secret using a public key with no known private key.

Timestamping the NUMS key is important so that users can trust KMS keys created by other users. A KMS key can be created with a policy permanently restricting access to the enclave, which other users can verify, but it is not currently possible to view past policies of the key. By timestamping the NUMS key _after_ verifying the policy, we can be certain that the master private key was not derived outside the enclave. 

## Proxy Architecture

TODO